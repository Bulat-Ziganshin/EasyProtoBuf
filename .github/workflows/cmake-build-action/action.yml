name: CMake

runs:
  using: composite
  steps:
    # Turn repeated input strings (such as the build output directory) into step outputs. These step outputs can be used throughout the workflow file.
    - name: Set reusable strings
      id: strings
      shell: bash
      run: |
        echo "build-output-dir=build" >> "$GITHUB_OUTPUT"



    - name: 'Debug: Configure CMake'
      shell: bash
      run: >
        cmake -B ${{ steps.strings.outputs.build-output-dir }}
        -DCMAKE_CXX_COMPILER=${CPP_COMPILER}
        "-DEASYPB_CXX_FLAGS=${CPP_OPTIONS}"
        -DCMAKE_BUILD_TYPE=Debug
        ${EXTRA_CMAKE_OPTIONS}

    - name: 'Debug: Build'
      shell: bash
      run: cmake --build ${{ steps.strings.outputs.build-output-dir }} --config Debug

    - name: 'Debug: Test'
      working-directory: ${{ steps.strings.outputs.build-output-dir }}
      shell: bash
      run: ctest --build-config Debug



    - name: 'Release: Configure CMake'
      shell: bash
      run: >
        cmake -B ${{ steps.strings.outputs.build-output-dir }}
        -DCMAKE_CXX_COMPILER=${CPP_COMPILER}
        "-DEASYPB_CXX_FLAGS=${CPP_OPTIONS}"
        -DCMAKE_BUILD_TYPE=Release
        ${EXTRA_CMAKE_OPTIONS}

    - name: 'Release: Build'
      shell: bash
      run: cmake --build ${{ steps.strings.outputs.build-output-dir }} --config Release

    - name: 'Release: Test'
      working-directory: ${{ steps.strings.outputs.build-output-dir }}
      shell: bash
      run: ctest --build-config Release



    - name: 'MinSizeRel: Configure CMake'
      shell: bash
      run: >
        cmake -B ${{ steps.strings.outputs.build-output-dir }}
        -DCMAKE_CXX_COMPILER=${CPP_COMPILER}
        "-DEASYPB_CXX_FLAGS=${CPP_OPTIONS}"
        -DCMAKE_BUILD_TYPE=MinSizeRel
        ${EXTRA_CMAKE_OPTIONS}

    - name: 'MinSizeRel: Build'
      shell: bash
      run: cmake --build ${{ steps.strings.outputs.build-output-dir }} --config MinSizeRel

    - name: 'MinSizeRel: Test'
      working-directory: ${{ steps.strings.outputs.build-output-dir }}
      shell: bash
      run: ctest --build-config MinSizeRel
